# Глава 2. Буферы, окна и вкладки

Если вы раньше пользовались современным текстовым редактором, то наверняка знакомы с окнами и вкладками. Vim использует три абстракции отображения вместо двух: буферы, окна и вкладки. В этой главе я объясню, что такое буферы, окна и вкладки и как они работают в Vim.

Прежде чем начать, убедитесь, что у вас есть опция `set hidden` в vimrc. Без него, всякий раз, когда вы переключаете буферы, а ваш текущий буфер не сохраняется, Vim предложит вам сохранить файл (вам это не нужно, если вы хотите быстро переместиться). Я еще не освещал vimrc. Если у вас нет vimrc, создайте его. Обычно он помещается в ваш домашний каталог и называется `.vimrc`. У меня есть свой в `~/.vimrc`. Чтобы узнать, где вы должны создать свой vimrc, ознакомьтесь с `:h vimrc`. В файле vimrc добавьте:

```
set hidden
```

Сохраните его, а затем примените изменения (запустите `:source %` из vimrc).

## Буферы

Что такое *буфер*?

Буфер — это пространство в памяти, где вы можете писать и редактировать текст. Когда вы открываете файл в Vim, данные привязываются к буферу. Когда вы открываете 3 файла в Vim, у вас есть 3 буфера.

Вам нужно два пустых файла, `file1.js` и `file2.js` (если возможно, создайте их с помощью Vim). В терминале выполните:

```bash
vim file1.js
```

То, что вы видите, это *буфер* `file1.js`. Каждый раз, когда вы открываете новый файл, Vim создает новый буфер.

Выйдите из Vim. На этот раз откройте два новых файла:

```bash
vim file1.js file2.js
```

В настоящее время Vim отображает буфер `file1.js`, но на самом деле он создает два буфера: буфер `file1.js` и буфер `file2.js`. Запустите `:buffers`, чтобы увидеть все буферы (в качестве альтернативы вы также можете использовать `:ls` или `:files`). Вы должны увидеть в списке *оба* `file1.js` и `file2.js`. Запуск `vim file1 file2 file3... filen` создает n буферов. Каждый раз, когда вы открываете новый файл, Vim создает новый буфер для этого файла.

Существует несколько способов переключения буферов:

- `:bnext` для перехода к следующему буферу (`:bprevious` для перехода к предыдущему буферу).
- `:buffer` + имя файла. Vim может автоматически дополнять имя файла с помощью `<Tab>`.
- `:buffer` + `n`, где `n` — номер буфера. Например, набрав `:buffer 2`, вы перейдете к буферу #2.
- Переход на старую позицию в списке переходов с помощью `Ctrl-O` и на более новую позицию с помощью `Ctrl-I`. Эти методы не конкретно для буфера, но их можно использовать для перехода между различными буферами. Более подробно я объясню это в главе 5.
- Переход в ранее отредактированный буфер с помощью `Ctrl-^`.

Как только Vim создаст буфер, он останется в вашем списке буферов. Чтобы удалить его, вы можете набрать `:bdelete`. Он также может принимать номер буфера в качестве параметра (`:bdelete 3` для удаления буфера #3) или имя файла (`:bdelete`, затем используйте `<Tab>` для автозаполнения).

Самым сложным для меня при изучении буферов было визуализировать то, как они работают, потому что мой мозг привык к окнам из обычного текстового редактора. Хорошей аналогией является колода игральных карт. Два буфера, это как стопка из двух карт. Карта сверху — единственная карта, которую я вижу, но я знаю, что есть карты и под ней. Если я вижу буфер `file1.js`, значит, карта `file1.js` находится в верхней части колоды. Я не вижу другой карты, `file2.js`, но она есть. Если я переключу буферы на `file2.js`, то эта карта `file2.js` окажется в верхней части колоды, а карта `file1.js` под ней.

Если вы раньше не использовали Vim, то это новая концепция. Не торопитесь, чтобы понять это.

## Выход из Vim

Кстати, если у вас открыто несколько буферов, вы можете закрыть их все с помощью quit-all:

```
:qall
```

Если вы хотите закрыть без сохранения изменений, просто добавьте `!` в конце:

```
:qall!
```

Чтобы сохранить все буферы и выйти, выполните:

```
:wqall
```

## Окна

Окно — это окно просмотра на буфер. Если вы пришли из обычного редактора, эта концепция может быть вам знакома. Большинство текстовых редакторов имеют возможность отображать несколько окон. В Vim вы также можете иметь несколько окон.

Снова откроем `file1.js` из терминала:

```bash
vim file1.js
```

Ранее я писал, что вы смотрите на буфер `file1.js`. Хотя это и было верно, это утверждение было неполным. Вы смотрите на буфер `file1.js`, отображаемый через **окно**. Окно — это способ просмотра буфера.

Не выходя из Vim, выполните:

```
:split file2.js
```

Теперь вы смотрите на два буфера через **два окна**. В верхнем окне отображается буфер `file2.js`. В нижнем окне отображается буфер `file1.js`.

Если вы хотите перемещаться между окнами, используйте следующие сочетания клавиш:

```
Ctrl-W H    Перемещает курсор в левое окно
Ctrl-W J    Перемещает курсор в нижнее окно
Ctrl-W K    Перемещает курсор в верхнее окно
Ctrl-W L    Перемещает курсор в правое окно
```

Теперь выполните:

```
:vsplit file3.js
```

Теперь вы видите три окна с тремя буферами. В одном окне отображается буфер `file3.js`, в другом - буфер `file2.js`, а в третьем - буфер `file1.js`.

У вас может быть несколько окон, отображающих один и тот же буфер. В левом верхнем окне введите:

```
:buffer file2.js
```

Теперь оба окна отображают буфер `file2.js`. Если вы начнете печатать в окне `file2.js`, вы увидите, что оба окна, отображающие буферы `file2.js`, обновляются в режиме реального времени.

Чтобы закрыть текущее окно, вы можете запустить `Ctrl-W C` или набрать `:quit`. Когда вы закроете окно, буфер все еще будет существовать (запустите `:buffers`, чтобы убедиться в этом).

Вот несколько полезных команд для окон когда вы находитесь в обычном режиме:

```
Ctrl-W V    Открывает новое по вертикали
Ctrl-W S    Открывает новое по горизонтали
Ctrl-W C    Закрывает окно
Ctrl-W O    Делает текущее окно единственным на экране и закрывает другие окна
```

А вот список полезных команд для окон когда вы находитесь в командной строке:

```
:vsplit filename    Разделяет окно по вертикали
:split filename     Разделяет окно по горизонтали
:new filename       Создает новое окно
```

Не торопитесь, чтобы разобраться в них. Для получения дополнительной информации ознакомьтесь с `:h window`.

## Вкладки

Вкладка — это набор окон. Думайте об этом как о макете для окон. В большинстве современных текстовых редакторах (и современных интернет-браузерах) вкладка означает открытый файл / страницу, и когда вы ее закрываете, этот файл / страница исчезает. В Vim вкладка не представляет собой открытый файл. Когда вы закрываете вкладку в Vim, вы не закрываете файл. Вы только закрываете макет. Файлы, открытые в этом макете, по-прежнему не закрыты, они по-прежнему открыты в своих буферах.

Давайте посмотрим на вкладки Vim в действии. Откройте `file1.js`:

```bash
vim file1.js
```

Чтобы открыть `file2.js` в новой вкладке:

```
:tabnew file2.js
```

Вы также можете позволить Vim автоматически дополнить выбор файлом, который вы хотите открыть в *новой вкладке*, нажав `<Tab>` (без каламбура).

Ниже приведен список полезных команд навигации по вкладкам:

```
:tabnew file.txt    Открывает file.txt в новой вкладке
:tabclose           Закрывает текущую вкладку
:tabnext            Перейти на следующую вкладку
:tabprevious        Перейти на предыдущую вкладку
:tablast            Перейти на последнюю вкладку
:tabfirst           Перейти на первую вкладку
```

Вы также можете выполнить `gt`, чтобы перейти на страницу следующей вкладки (вы можете перейти на предыдущую вкладку с помощью `gT`). Вы можете передать count в качестве аргумента в `gt`, где count — номер вкладки. Чтобы перейти к третьей вкладке, выполните `3gt`.

Одним из преимуществ наличия нескольких вкладок является то, что вы можете иметь разное расположение окон в разных вкладках. Возможно, вы хотите, чтобы ваша первая вкладка имела три вертикальных окна, а вторая вкладка имела смешанный горизонтальный и вертикальный макет окон. Tab — идеальный инструмент для работы!

Чтобы запустить Vim с несколькими вкладками, в терминале выполните:

```bash
vim -p file1.js file2.js file3.js
```

## Перемещение в 3D

Перемещение между окнами похоже на двухмерное перемещение по оси X-Y в декартовых координатах. Вы можете перемещаться в верхнее, правое, нижнее и левое окно с помощью `Ctrl-W H/J/K/L`.

Перемещение между буферами похоже на перемещение по оси Z в декартовых координатах. Представьте, что буферные файлы выстроены вдоль оси Z. Вы можете перемещаться по оси Z по одному буферу за раз с помощью `:bnext` и `:bprevious` или вы можете перейти к любой координате на оси Z с помощью `:buffer filename/buffernumber`.

Вы можете перемещаться в *трехмерном пространстве*, комбинируя движения окон и буферов. Вы можете перемещаться в верхнее, правое, нижнее или левое окно (переходы по осям X-Y) с помощью перемещений окон. Поскольку каждое окно содержит буферы, вы можете перемещаться вперед и назад (Z-переходы) с помощью перемещений буферов.

## Использование буферов, окон и вкладок c умом

Вы узнали, что такое буферы, окна и вкладки и как они работают в Vim. Теперь, когда вы лучше понимаете их, вы можете использовать их в своем рабочем процессе.

У всех разный рабочий процесс, для примера, вот мой:

- Я использую буферы для хранения всех необходимых файлов для текущей задачи. Vim может обрабатывать множество открытых буферов, прежде чем он начнет замедляться. Кроме того, наличие большого количества открытых буферов не будет перегружать мой экран. В любой момент времени я вижу только один буфер (при условии, что у меня только одно окно), что позволяет мне сосредоточиться на одном экране. Когда мне нужно куда-то перейти, я в любое время могу быстро перескачить на любой открытый буфер.
- Я использую несколько окон для одновременного просмотра нескольких буферов, обычно при сравнении файлов, чтении документации или следовании потоку кода. Я стараюсь, чтобы количество открытых окон не превышало трех, потому что мой экран будет переполнен (я использую небольшой ноутбук). Когда я заканчиваю, я закрываю все дополнительные окна. Чем меньше окон, тем меньше отвлекающих факторов.
- Вместо вкладок я использую окна [tmux](https://github.com/tmux/tmux/wiki). Обычно я использую сразу несколько окон tmux. Например, одно окно tmux для клиентского кода, а другое для кода серверной части.

Мой рабочий процесс может отличаться от вашего, в зависимости от вашего стиля редактирования, и это нормально. Экспериментируйте, чтобы найти свой собственный подход, соответствующий вашему стилю кодирования.
